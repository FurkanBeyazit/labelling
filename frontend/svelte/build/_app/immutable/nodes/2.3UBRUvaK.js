import{C as Oe,s as Xe,n as pe,d as f,Q as qe,i as J,q as c,c as _,e as C,h as v,R as Qe,a as he,S as me,b as o,p as oe,f as q,g as U,r as ee,t as Z,j as z,T as rt,U as We,V as ye,K as St,x as Vt,W as Ft,X as Pt,Y as At,Z as Nt,_ as jt,B as it,$ as Re,a0 as Ye}from"../chunks/DpiqhjtG.js";import{a as Ve,S as Ze,i as Ge,d as $e,t as je,c as ct,m as et,e as tt,b as lt,g as dt}from"../chunks/YI1KV5sL.js";function Ie(s){return(s==null?void 0:s.length)!==void 0?s:Array.from(s)}function Mt(s,e){s.d(1),e.delete(s.key)}function Lt(s,e,t,l,n,a,i,d,r,T,m,h){let k=s.length,b=a.length,y=k;const S={};for(;y--;)S[s[y].key]=y;const x=[],Y=new Map,F=new Map,M=[];for(y=b;y--;){const p=h(n,a,y),D=t(p);let I=i.get(D);I?M.push(()=>I.p(p,e)):(I=T(D,p),I.c()),Y.set(D,x[y]=I),D in S&&F.set(D,Math.abs(y-S[D]))}const P=new Set,w=new Set;function g(p){Ve(p,1),p.m(d,m),i.set(p.key,p),m=p.first,b--}for(;k&&b;){const p=x[b-1],D=s[k-1],I=p.key,K=D.key;p===D?(m=p.first,k--,b--):Y.has(K)?!i.has(I)||P.has(I)?g(p):w.has(K)?k--:F.get(I)>F.get(K)?(w.add(I),g(p)):(P.add(K),k--):(r(D,i),k--)}for(;k--;){const p=s[k];Y.has(p.key)||r(p,i)}for(;b;)g(x[b-1]);return Oe(M),x}function ft(s,e,t){const l=s.slice();return l[8]=e[t],l}function ut(s){let e,t="No videos uploaded";return{c(){e=v("p"),e.textContent=t,this.h()},l(l){e=_(l,"P",{class:!0,"data-svelte-h":!0}),ee(e)!=="svelte-gblcz6"&&(e.textContent=t),this.h()},h(){c(e,"class","text-center text-base-content/50 py-4")},m(l,n){J(l,e,n)},p:pe,d(l){l&&f(e)}}}function ht(s){let e,t=s[8].approved_count+"",l,n;return{c(){e=v("span"),l=Z(t),n=Z(" labeled"),this.h()},l(a){e=_(a,"SPAN",{class:!0});var i=C(e);l=q(i,t),n=q(i," labeled"),i.forEach(f),this.h()},h(){c(e,"class","badge badge-sm badge-success")},m(a,i){J(a,e,i),o(e,l),o(e,n)},p(a,i){i&1&&t!==(t=a[8].approved_count+"")&&he(l,t)},d(a){a&&f(e)}}}function _t(s){let e,t=s[8].pending_count+"",l,n;return{c(){e=v("span"),l=Z(t),n=Z(" pending"),this.h()},l(a){e=_(a,"SPAN",{class:!0});var i=C(e);l=q(i,t),n=q(i," pending"),i.forEach(f),this.h()},h(){c(e,"class","badge badge-sm badge-warning")},m(a,i){J(a,e,i),o(e,l),o(e,n)},p(a,i){i&1&&t!==(t=a[8].pending_count+"")&&he(l,t)},d(a){a&&f(e)}}}function vt(s){let e,t,l,n,a,i=s[8].filename+"",d,r,T,m,h,k=s[8].frames_count+"",b,y,S,x,Y,F,M='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>',P,w,g,p=s[8].approved_count>0&&ht(s),D=s[8].pending_count>0&&_t(s);function I(...N){return s[4](s[8],...N)}function K(){return s[5](s[8])}function W(...N){return s[6](s[8],...N)}return{c(){e=v("div"),t=v("div"),l=v("div"),n=v("div"),a=v("h3"),d=Z(i),T=z(),m=v("div"),h=v("span"),b=Z(k),y=Z(" frames"),S=z(),p&&p.c(),x=z(),D&&D.c(),Y=z(),F=v("button"),F.innerHTML=M,P=z(),this.h()},l(N){e=_(N,"DIV",{class:!0,role:!0,tabindex:!0});var A=C(e);t=_(A,"DIV",{class:!0});var ie=C(t);l=_(ie,"DIV",{class:!0});var Q=C(l);n=_(Q,"DIV",{class:!0});var E=C(n);a=_(E,"H3",{class:!0,title:!0});var j=C(a);d=q(j,i),j.forEach(f),T=U(E),m=_(E,"DIV",{class:!0});var L=C(m);h=_(L,"SPAN",{class:!0});var le=C(h);b=q(le,k),y=q(le," frames"),le.forEach(f),S=U(L),p&&p.l(L),x=U(L),D&&D.l(L),L.forEach(f),E.forEach(f),Y=U(Q),F=_(Q,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),ee(F)!=="svelte-49snm3"&&(F.innerHTML=M),Q.forEach(f),ie.forEach(f),P=U(A),A.forEach(f),this.h()},h(){var N,A;c(a,"class","font-medium text-sm truncate"),c(a,"title",r=s[8].filename),c(h,"class","badge badge-sm badge-ghost"),c(m,"class","flex gap-2 mt-1"),c(n,"class","flex-1 min-w-0"),c(F,"class","btn btn-ghost btn-xs btn-square text-error"),c(F,"title","Delete video"),c(l,"class","flex justify-between items-start"),c(t,"class","card-body p-3"),c(e,"class","card bg-base-100 cursor-pointer hover:bg-base-300 transition-colors"),c(e,"role","button"),c(e,"tabindex","0"),me(e,"ring-2",((N=s[1])==null?void 0:N.video_id)===s[8].video_id),me(e,"ring-primary",((A=s[1])==null?void 0:A.video_id)===s[8].video_id)},m(N,A){J(N,e,A),o(e,t),o(t,l),o(l,n),o(n,a),o(a,d),o(n,T),o(n,m),o(m,h),o(h,b),o(h,y),o(m,S),p&&p.m(m,null),o(m,x),D&&D.m(m,null),o(l,Y),o(l,F),o(e,P),w||(g=[oe(F,"click",I),oe(e,"click",K),oe(e,"keypress",W)],w=!0)},p(N,A){var ie,Q;s=N,A&1&&i!==(i=s[8].filename+"")&&he(d,i),A&1&&r!==(r=s[8].filename)&&c(a,"title",r),A&1&&k!==(k=s[8].frames_count+"")&&he(b,k),s[8].approved_count>0?p?p.p(s,A):(p=ht(s),p.c(),p.m(m,x)):p&&(p.d(1),p=null),s[8].pending_count>0?D?D.p(s,A):(D=_t(s),D.c(),D.m(m,null)):D&&(D.d(1),D=null),A&3&&me(e,"ring-2",((ie=s[1])==null?void 0:ie.video_id)===s[8].video_id),A&3&&me(e,"ring-primary",((Q=s[1])==null?void 0:Q.video_id)===s[8].video_id)},d(N){N&&f(e),p&&p.d(),D&&D.d(),w=!1,Oe(g)}}}function Ot(s){let e,t=Ie(s[0]),l=[];for(let a=0;a<t.length;a+=1)l[a]=vt(ft(s,t,a));let n=null;return t.length||(n=ut()),{c(){e=v("div");for(let a=0;a<l.length;a+=1)l[a].c();n&&n.c(),this.h()},l(a){e=_(a,"DIV",{class:!0});var i=C(e);for(let d=0;d<l.length;d+=1)l[d].l(i);n&&n.l(i),i.forEach(f),this.h()},h(){c(e,"class","space-y-2")},m(a,i){J(a,e,i);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(e,null);n&&n.m(e,null)},p(a,[i]){if(i&15){t=Ie(a[0]);let d;for(d=0;d<t.length;d+=1){const r=ft(a,t,d);l[d]?l[d].p(r,i):(l[d]=vt(r),l[d].c(),l[d].m(e,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=t.length,!t.length&&n?n.p(a,i):t.length?n&&(n.d(1),n=null):(n=ut(),n.c(),n.m(e,null))}},i:pe,o:pe,d(a){a&&f(e),qe(l,a),n&&n.d()}}}function Bt(s,e,t){let{videos:l=[]}=e,{selectedVideo:n=null}=e;const a=Qe();function i(h){a("select",h)}async function d(h,k){if(k.stopPropagation(),!!confirm(`Delete "${h.filename}"?

This will also delete ${h.frames_count} frames and ${h.approved_count} labels.`))try{await fetch(`/api/videos/${h.video_id}`,{method:"DELETE"}),a("refresh")}catch(b){console.error("Delete failed:",b)}}const r=(h,k)=>d(h,k),T=h=>i(h),m=(h,k)=>k.key==="Enter"&&i(h);return s.$$set=h=>{"videos"in h&&t(0,l=h.videos),"selectedVideo"in h&&t(1,n=h.selectedVideo)},[l,n,i,d,r,T,m]}class Ht extends Ze{constructor(e){super(),Ge(this,e,Bt,Ot,Xe,{videos:0,selectedVideo:1})}}function mt(s,e,t){const l=s.slice();return l[7]=e[t],l}function pt(s){let e,t=`No frames extracted
    `;return{c(){e=v("p"),e.textContent=t,this.h()},l(l){e=_(l,"P",{class:!0,"data-svelte-h":!0}),ee(e)!=="svelte-1ofhpom"&&(e.textContent=t),this.h()},h(){c(e,"class","col-span-2 text-center text-base-content/50 py-4")},m(l,n){J(l,e,n)},p:pe,d(l){l&&f(e)}}}function Ut(s){let e,t="Pending";return{c(){e=v("span"),e.textContent=t,this.h()},l(l){e=_(l,"SPAN",{class:!0,"data-svelte-h":!0}),ee(e)!=="svelte-1x25i2q"&&(e.textContent=t),this.h()},h(){c(e,"class","badge badge-warning badge-xs")},m(l,n){J(l,e,n)},d(l){l&&f(e)}}}function zt(s){let e,t="Labeled";return{c(){e=v("span"),e.textContent=t,this.h()},l(l){e=_(l,"SPAN",{class:!0,"data-svelte-h":!0}),ee(e)!=="svelte-1phew4h"&&(e.textContent=t),this.h()},h(){c(e,"class","badge badge-success badge-xs")},m(l,n){J(l,e,n)},d(l){l&&f(e)}}}function bt(s){let e,t,l,n,a,i,d,r,T,m=s[7].frame_number+"",h,k,b,y,S,x;function Y(g,p){return g[7].has_label?zt:Ut}let F=Y(s),M=F(s);function P(){return s[4](s[7])}function w(...g){return s[5](s[7],...g)}return{c(){e=v("div"),t=v("img"),a=z(),i=v("div"),M.c(),d=z(),r=v("div"),T=Z("Frame "),h=Z(m),k=z(),b=v("div"),y=z(),this.h()},l(g){e=_(g,"DIV",{class:!0,role:!0,tabindex:!0});var p=C(e);t=_(p,"IMG",{src:!0,alt:!0,class:!0,loading:!0}),a=U(p),i=_(p,"DIV",{class:!0});var D=C(i);M.l(D),D.forEach(f),d=U(p),r=_(p,"DIV",{class:!0});var I=C(r);T=q(I,"Frame "),h=q(I,m),I.forEach(f),k=U(p),b=_(p,"DIV",{class:!0}),C(b).forEach(f),y=U(p),p.forEach(f),this.h()},h(){var g,p;rt(t.src,l="/api/frames/"+s[2]+"/"+s[7].frame_id+"/image")||c(t,"src",l),c(t,"alt",n="Frame "+s[7].frame_number),c(t,"class","w-full aspect-video object-cover bg-base-300"),c(t,"loading","lazy"),c(i,"class","absolute top-1 right-1"),c(r,"class","absolute bottom-0 left-0 right-0 bg-black/50 text-white text-xs px-2 py-1"),c(b,"class","absolute inset-0 bg-primary/20 opacity-0 group-hover:opacity-100 transition-opacity"),c(e,"class","relative cursor-pointer group rounded-lg overflow-hidden"),c(e,"role","button"),c(e,"tabindex","0"),me(e,"ring-2",((g=s[1])==null?void 0:g.frame_id)===s[7].frame_id),me(e,"ring-primary",((p=s[1])==null?void 0:p.frame_id)===s[7].frame_id)},m(g,p){J(g,e,p),o(e,t),o(e,a),o(e,i),M.m(i,null),o(e,d),o(e,r),o(r,T),o(r,h),o(e,k),o(e,b),o(e,y),S||(x=[oe(e,"click",P),oe(e,"keypress",w)],S=!0)},p(g,p){var D,I;s=g,p&5&&!rt(t.src,l="/api/frames/"+s[2]+"/"+s[7].frame_id+"/image")&&c(t,"src",l),p&1&&n!==(n="Frame "+s[7].frame_number)&&c(t,"alt",n),F!==(F=Y(s))&&(M.d(1),M=F(s),M&&(M.c(),M.m(i,null))),p&1&&m!==(m=s[7].frame_number+"")&&he(h,m),p&3&&me(e,"ring-2",((D=s[1])==null?void 0:D.frame_id)===s[7].frame_id),p&3&&me(e,"ring-primary",((I=s[1])==null?void 0:I.frame_id)===s[7].frame_id)},d(g){g&&f(e),M.d(),S=!1,Oe(x)}}}function Rt(s){let e,t=Ie(s[0]),l=[];for(let a=0;a<t.length;a+=1)l[a]=bt(mt(s,t,a));let n=null;return t.length||(n=pt()),{c(){e=v("div");for(let a=0;a<l.length;a+=1)l[a].c();n&&n.c(),this.h()},l(a){e=_(a,"DIV",{class:!0});var i=C(e);for(let d=0;d<l.length;d+=1)l[d].l(i);n&&n.l(i),i.forEach(f),this.h()},h(){c(e,"class","grid grid-cols-2 gap-2")},m(a,i){J(a,e,i);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(e,null);n&&n.m(e,null)},p(a,[i]){if(i&15){t=Ie(a[0]);let d;for(d=0;d<t.length;d+=1){const r=mt(a,t,d);l[d]?l[d].p(r,i):(l[d]=bt(r),l[d].c(),l[d].m(e,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=t.length,!t.length&&n?n.p(a,i):t.length?n&&(n.d(1),n=null):(n=pt(),n.c(),n.m(e,null))}},i:pe,o:pe,d(a){a&&f(e),qe(l,a),n&&n.d()}}}function Yt(s,e,t){let{frames:l=[]}=e,{selectedFrame:n=null}=e,{videoId:a=""}=e;const i=Qe();function d(m){i("select",m)}const r=m=>d(m),T=(m,h)=>h.key==="Enter"&&d(m);return s.$$set=m=>{"frames"in m&&t(0,l=m.frames),"selectedFrame"in m&&t(1,n=m.selectedFrame),"videoId"in m&&t(2,a=m.videoId)},[l,n,a,d,r,T]}class Wt extends Ze{constructor(e){super(),Ge(this,e,Yt,Rt,Xe,{frames:0,selectedFrame:1,videoId:2})}}function gt(s,e,t){const l=s.slice();return l[50]=e[t],l[52]=t,l}function wt(s,e,t){const l=s.slice();return l[53]=e[t],l}function kt(s,e,t){const l=s.slice();return l[53]=e[t],l}function Ct(s){let e,t=s[53].class_name+"",l,n;return{c(){e=v("option"),l=Z(t),this.h()},l(a){e=_(a,"OPTION",{});var i=C(e);l=q(i,t),i.forEach(f),this.h()},h(){e.__value=n=s[53].class_id,ye(e,e.__value)},m(a,i){J(a,e,i),o(e,l)},p(a,i){i[0]&4&&t!==(t=a[53].class_name+"")&&he(l,t),i[0]&4&&n!==(n=a[53].class_id)&&(e.__value=n,ye(e,e.__value))},d(a){a&&f(e)}}}function Xt(s){let e;return{c(){e=Z("Save")},l(t){e=q(t,"Save")},m(t,l){J(t,e,l)},d(t){t&&f(e)}}}function qt(s){let e;return{c(){e=Z("Saving...")},l(t){e=q(t,"Saving...")},m(t,l){J(t,e,l)},d(t){t&&f(e)}}}function Et(s){let e,t=`<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
        Saved!`;return{c(){e=v("span"),e.innerHTML=t,this.h()},l(l){e=_(l,"SPAN",{class:!0,"data-svelte-h":!0}),ee(e)!=="svelte-gko9zj"&&(e.innerHTML=t),this.h()},h(){c(e,"class","badge badge-success gap-1 animate-pulse")},m(l,n){J(l,e,n)},d(l){l&&f(e)}}}function yt(s){let e,t,l=Math.round(s[8]*100)+"",n,a,i,d,r="Reset",T,m;return{c(){e=v("div"),t=v("span"),n=Z(l),a=Z("%"),i=z(),d=v("button"),d.textContent=r,this.h()},l(h){e=_(h,"DIV",{class:!0});var k=C(e);t=_(k,"SPAN",{class:!0});var b=C(t);n=q(b,l),a=q(b,"%"),b.forEach(f),i=U(k),d=_(k,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),ee(d)!=="svelte-917t1g"&&(d.textContent=r),k.forEach(f),this.h()},h(){c(t,"class","text-xs font-mono"),c(d,"class","btn btn-xs btn-ghost"),c(d,"title","Reset zoom (back to 100%)"),c(e,"class","absolute bottom-2 left-2 flex items-center gap-2 bg-base-100/90 rounded-lg px-2 py-1 shadow")},m(h,k){J(h,e,k),o(e,t),o(t,n),o(t,a),o(e,i),o(e,d),T||(m=oe(d,"click",s[9]),T=!0)},p(h,k){k[0]&256&&l!==(l=Math.round(h[8]*100)+"")&&he(n,l)},d(h){h&&f(e),T=!1,m()}}}function Tt(s){let e,t='<td colspan="5" class="text-center opacity-50 py-6">No labels. Draw boxes or click Auto Label.</td> ';return{c(){e=v("tr"),e.innerHTML=t},l(l){e=_(l,"TR",{"data-svelte-h":!0}),ee(e)!=="svelte-1dukwmb"&&(e.innerHTML=t)},m(l,n){J(l,e,n)},p:pe,d(l){l&&f(e)}}}function Dt(s){let e,t=s[53].class_name+"",l,n;return{c(){e=v("option"),l=Z(t),this.h()},l(a){e=_(a,"OPTION",{});var i=C(e);l=q(i,t),i.forEach(f),this.h()},h(){e.__value=n=s[53].class_id,ye(e,e.__value)},m(a,i){J(a,e,i),o(e,l)},p(a,i){i[0]&4&&t!==(t=a[53].class_name+"")&&he(l,t),i[0]&4&&n!==(n=a[53].class_id)&&(e.__value=n,ye(e,e.__value))},d(a){a&&f(e)}}}function Zt(s){let e,t="-";return{c(){e=v("span"),e.textContent=t,this.h()},l(l){e=_(l,"SPAN",{class:!0,"data-svelte-h":!0}),ee(e)!=="svelte-umsp1d"&&(e.textContent=t),this.h()},h(){c(e,"class","opacity-50")},m(l,n){J(l,e,n)},p:pe,d(l){l&&f(e)}}}function Gt(s){let e,t=Math.round(s[50].confidence*100)+"",l,n;return{c(){e=v("span"),l=Z(t),n=Z("%"),this.h()},l(a){e=_(a,"SPAN",{class:!0});var i=C(e);l=q(i,t),n=q(i,"%"),i.forEach(f),this.h()},h(){c(e,"class","badge badge-sm badge-ghost")},m(a,i){J(a,e,i),o(e,l),o(e,n)},p(a,i){i[0]&64&&t!==(t=Math.round(a[50].confidence*100)+"")&&he(l,t)},d(a){a&&f(e)}}}function It(s,e){let t,l,n=e[52]+1+"",a,i,d,r,T,m,h,k,b,y,S=(e[50].source||"manual")+"",x,Y,F,M,P="Delete",w,g,p,D=Ie(e[2]),I=[];for(let E=0;E<D.length;E+=1)I[E]=Dt(wt(e,D,E));function K(...E){return e[25](e[50],...E)}function W(E,j){return E[50].confidence?Gt:Zt}let N=W(e),A=N(e);function ie(...E){return e[26](e[50],...E)}function Q(){return e[27](e[50])}return{key:s,first:null,c(){t=v("tr"),l=v("td"),a=Z(n),i=z(),d=v("td"),r=v("select");for(let E=0;E<I.length;E+=1)I[E].c();m=z(),h=v("td"),A.c(),k=z(),b=v("td"),y=v("span"),x=Z(S),Y=z(),F=v("td"),M=v("button"),M.textContent=P,w=z(),this.h()},l(E){t=_(E,"TR",{class:!0});var j=C(t);l=_(j,"TD",{});var L=C(l);a=q(L,n),L.forEach(f),i=U(j),d=_(j,"TD",{});var le=C(d);r=_(le,"SELECT",{class:!0});var te=C(r);for(let de=0;de<I.length;de+=1)I[de].l(te);te.forEach(f),le.forEach(f),m=U(j),h=_(j,"TD",{});var se=C(h);A.l(se),se.forEach(f),k=U(j),b=_(j,"TD",{});var _e=C(b);y=_(_e,"SPAN",{class:!0});var H=C(y);x=q(H,S),H.forEach(f),_e.forEach(f),Y=U(j),F=_(j,"TD",{});var G=C(F);M=_(G,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),ee(M)!=="svelte-k3tdv0"&&(M.textContent=P),G.forEach(f),w=U(j),j.forEach(f),this.h()},h(){c(r,"class","select select-xs select-bordered w-full max-w-[120px]"),c(y,"class","badge badge-xs"),me(y,"badge-info",e[50].source==="auto"),me(y,"badge-ghost",e[50].source!=="auto"),c(M,"class","btn btn-ghost btn-xs text-error"),c(M,"title","Delete this label"),c(t,"class","cursor-pointer hover:bg-base-200"),me(t,"bg-primary",e[5]===e[50].rect),me(t,"bg-opacity-20",e[5]===e[50].rect),this.first=t},m(E,j){J(E,t,j),o(t,l),o(l,a),o(t,i),o(t,d),o(d,r);for(let L=0;L<I.length;L+=1)I[L]&&I[L].m(r,null);We(r,e[50].class_id),o(t,m),o(t,h),A.m(h,null),o(t,k),o(t,b),o(b,y),o(y,x),o(t,Y),o(t,F),o(F,M),o(t,w),g||(p=[oe(r,"change",K),oe(r,"click",Pt(e[21])),oe(M,"click",ie),oe(t,"click",Q)],g=!0)},p(E,j){if(e=E,j[0]&64&&n!==(n=e[52]+1+"")&&he(a,n),j[0]&4){D=Ie(e[2]);let L;for(L=0;L<D.length;L+=1){const le=wt(e,D,L);I[L]?I[L].p(le,j):(I[L]=Dt(le),I[L].c(),I[L].m(r,null))}for(;L<I.length;L+=1)I[L].d(1);I.length=D.length}j[0]&68&&T!==(T=e[50].class_id)&&We(r,e[50].class_id),N===(N=W(e))&&A?A.p(e,j):(A.d(1),A=N(e),A&&(A.c(),A.m(h,null))),j[0]&64&&S!==(S=(e[50].source||"manual")+"")&&he(x,S),j[0]&64&&me(y,"badge-info",e[50].source==="auto"),j[0]&64&&me(y,"badge-ghost",e[50].source!=="auto"),j[0]&96&&me(t,"bg-primary",e[5]===e[50].rect),j[0]&96&&me(t,"bg-opacity-20",e[5]===e[50].rect)},d(E){E&&f(t),qe(I,E),A.d(),g=!1,Oe(p)}}}function xt(s){let e,t,l,n=s[6].length+"",a,i,d,r,T="Click row to select, change class from dropdown";return{c(){e=v("div"),t=v("span"),l=Z("Total: "),a=Z(n),i=Z(" label(s)"),d=z(),r=v("span"),r.textContent=T,this.h()},l(m){e=_(m,"DIV",{class:!0});var h=C(e);t=_(h,"SPAN",{});var k=C(t);l=q(k,"Total: "),a=q(k,n),i=q(k," label(s)"),k.forEach(f),d=U(h),r=_(h,"SPAN",{class:!0,"data-svelte-h":!0}),ee(r)!=="svelte-1ss4u1m"&&(r.textContent=T),h.forEach(f),this.h()},h(){c(r,"class","opacity-70"),c(e,"class","px-3 py-2 bg-base-200 text-xs flex justify-between")},m(m,h){J(m,e,h),o(e,t),o(t,l),o(t,a),o(t,i),o(e,d),o(e,r)},p(m,h){h[0]&64&&n!==(n=m[6].length+"")&&he(a,n)},d(m){m&&f(e)}}}function Jt(s){let e,t,l,n,a="New Class:",i,d,r,T,m,h="Conf:",k,b,y,S,x=Math.round(s[4]*100)+"",Y,F,M,P,w,g,p="Auto Label",D,I,K,W,N,A,ie="Clear All",Q,E,j,L,le,te,se,_e,H,G,de="Scroll: Zoom | Alt+Drag: Pan",Ce,ne,Te,be,ke,Se='<tr><th class="w-8">#</th> <th>Class</th> <th>Confidence</th> <th>Source</th> <th class="w-24">Actions</th></tr>',xe,Ee,fe=[],Fe=new Map,Be,u,V,X=Ie(s[2]),O=[];for(let B=0;B<X.length;B+=1)O[B]=Ct(kt(s,X,B));function ce(B,$){return B[7]==="saving"?qt:Xt}let ge=ce(s),we=ge(s),ae=s[7]==="saved"&&Et(),re=s[8]!==1&&yt(s),De=Ie(s[6]);const He=B=>B[50].index;for(let B=0;B<De.length;B+=1){let $=gt(s,De,B),R=He($);Fe.set(R,fe[B]=It(R,$))}let ue=null;De.length||(ue=Tt());let ve=s[6].length>0&&xt(s);return{c(){e=v("div"),t=v("div"),l=v("div"),n=v("span"),n.textContent=a,i=z(),d=v("select");for(let B=0;B<O.length;B+=1)O[B].c();r=z(),T=v("div"),m=v("span"),m.textContent=h,k=z(),b=v("input"),y=z(),S=v("span"),Y=Z(x),F=Z("%"),M=z(),P=v("div"),w=z(),g=v("button"),g.textContent=p,D=z(),I=v("button"),K=Z("Delete"),N=z(),A=v("button"),A.textContent=ie,Q=z(),E=v("button"),we.c(),L=z(),ae&&ae.c(),le=z(),te=v("div"),se=v("canvas"),_e=z(),re&&re.c(),H=z(),G=v("div"),G.textContent=de,Ce=z(),ne=v("div"),Te=v("div"),be=v("table"),ke=v("thead"),ke.innerHTML=Se,xe=z(),Ee=v("tbody");for(let B=0;B<fe.length;B+=1)fe[B].c();ue&&ue.c(),Be=z(),ve&&ve.c(),this.h()},l(B){e=_(B,"DIV",{class:!0});var $=C(e);t=_($,"DIV",{class:!0});var R=C(t);l=_(R,"DIV",{class:!0});var Pe=C(l);n=_(Pe,"SPAN",{class:!0,"data-svelte-h":!0}),ee(n)!=="svelte-1j9ugz0"&&(n.textContent=a),i=U(Pe),d=_(Pe,"SELECT",{class:!0});var st=C(d);for(let Ae=0;Ae<O.length;Ae+=1)O[Ae].l(st);st.forEach(f),Pe.forEach(f),r=U(R),T=_(R,"DIV",{class:!0});var Me=C(T);m=_(Me,"SPAN",{class:!0,"data-svelte-h":!0}),ee(m)!=="svelte-1psb6sb"&&(m.textContent=h),k=U(Me),b=_(Me,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0}),y=U(Me),S=_(Me,"SPAN",{class:!0});var Je=C(S);Y=q(Je,x),F=q(Je,"%"),Je.forEach(f),Me.forEach(f),M=U(R),P=_(R,"DIV",{class:!0}),C(P).forEach(f),w=U(R),g=_(R,"BUTTON",{class:!0,"data-svelte-h":!0}),ee(g)!=="svelte-179nf9h"&&(g.textContent=p),D=U(R),I=_(R,"BUTTON",{class:!0});var nt=C(I);K=q(nt,"Delete"),nt.forEach(f),N=U(R),A=_(R,"BUTTON",{class:!0,"data-svelte-h":!0}),ee(A)!=="svelte-nobjql"&&(A.textContent=ie),Q=U(R),E=_(R,"BUTTON",{class:!0});var at=C(E);we.l(at),at.forEach(f),L=U(R),ae&&ae.l(R),R.forEach(f),le=U($),te=_($,"DIV",{class:!0});var Le=C(te);se=_(Le,"CANVAS",{}),C(se).forEach(f),_e=U(Le),re&&re.l(Le),H=U(Le),G=_(Le,"DIV",{class:!0,"data-svelte-h":!0}),ee(G)!=="svelte-z182zw"&&(G.textContent=de),Le.forEach(f),Ce=U($),ne=_($,"DIV",{class:!0});var Ue=C(ne);Te=_(Ue,"DIV",{class:!0});var ot=C(Te);be=_(ot,"TABLE",{class:!0});var ze=C(be);ke=_(ze,"THEAD",{class:!0,"data-svelte-h":!0}),ee(ke)!=="svelte-149n8qj"&&(ke.innerHTML=Se),xe=U(ze),Ee=_(ze,"TBODY",{});var Ke=C(Ee);for(let Ae=0;Ae<fe.length;Ae+=1)fe[Ae].l(Ke);ue&&ue.l(Ke),Ke.forEach(f),ze.forEach(f),ot.forEach(f),Be=U(Ue),ve&&ve.l(Ue),Ue.forEach(f),$.forEach(f),this.h()},h(){c(n,"class","join-item btn btn-sm no-animation"),c(d,"class","select select-bordered select-sm join-item"),s[3]===void 0&&St(()=>s[22].call(d)),c(l,"class","join"),c(m,"class","text-xs opacity-70"),c(b,"type","range"),c(b,"min","0.1"),c(b,"max","0.9"),c(b,"step","0.05"),c(b,"class","range range-xs range-primary w-20"),c(S,"class","text-xs font-mono w-8"),c(T,"class","flex items-center gap-2 bg-base-100 px-3 py-1 rounded-lg"),c(P,"class","flex-1"),c(g,"class","btn btn-primary btn-sm"),c(I,"class","btn btn-error btn-sm"),I.disabled=W=!s[5],c(A,"class","btn btn-warning btn-sm"),c(E,"class","btn btn-success btn-sm"),E.disabled=j=s[7]==="saving",c(t,"class","flex flex-wrap gap-2 items-center shrink-0"),c(G,"class","absolute bottom-2 right-2 text-xs opacity-50 bg-base-100/70 rounded px-2 py-1"),c(te,"class","flex-1 flex items-center justify-center bg-base-300 rounded-lg overflow-hidden min-h-0 relative"),c(ke,"class","sticky top-0 bg-base-200 z-10"),c(be,"class","table table-xs table-zebra w-full"),c(Te,"class","overflow-x-auto max-h-32"),c(ne,"class","bg-base-100 rounded-lg overflow-hidden shrink-0"),c(e,"class","flex flex-col h-full gap-2 overflow-hidden")},m(B,$){J(B,e,$),o(e,t),o(t,l),o(l,n),o(l,i),o(l,d);for(let R=0;R<O.length;R+=1)O[R]&&O[R].m(d,null);We(d,s[3],!0),o(t,r),o(t,T),o(T,m),o(T,k),o(T,b),ye(b,s[4]),o(T,y),o(T,S),o(S,Y),o(S,F),o(t,M),o(t,P),o(t,w),o(t,g),o(t,D),o(t,I),o(I,K),o(t,N),o(t,A),o(t,Q),o(t,E),we.m(E,null),o(t,L),ae&&ae.m(t,null),o(e,le),o(e,te),o(te,se),s[24](se),o(te,_e),re&&re.m(te,null),o(te,H),o(te,G),o(e,Ce),o(e,ne),o(ne,Te),o(Te,be),o(be,ke),o(be,xe),o(be,Ee);for(let R=0;R<fe.length;R+=1)fe[R]&&fe[R].m(Ee,null);ue&&ue.m(Ee,null),o(ne,Be),ve&&ve.m(ne,null),s[28](e),u||(V=[oe(d,"change",s[22]),oe(b,"change",s[23]),oe(b,"input",s[23]),oe(g,"click",s[10]),oe(I,"click",s[12]),oe(A,"click",s[13]),oe(E,"click",s[11])],u=!0)},p(B,$){if($[0]&4){X=Ie(B[2]);let R;for(R=0;R<X.length;R+=1){const Pe=kt(B,X,R);O[R]?O[R].p(Pe,$):(O[R]=Ct(Pe),O[R].c(),O[R].m(d,null))}for(;R<O.length;R+=1)O[R].d(1);O.length=X.length}$[0]&12&&We(d,B[3]),$[0]&16&&ye(b,B[4]),$[0]&16&&x!==(x=Math.round(B[4]*100)+"")&&he(Y,x),$[0]&32&&W!==(W=!B[5])&&(I.disabled=W),ge!==(ge=ce(B))&&(we.d(1),we=ge(B),we&&(we.c(),we.m(E,null))),$[0]&128&&j!==(j=B[7]==="saving")&&(E.disabled=j),B[7]==="saved"?ae||(ae=Et(),ae.c(),ae.m(t,null)):ae&&(ae.d(1),ae=null),B[8]!==1?re?re.p(B,$):(re=yt(B),re.c(),re.m(te,H)):re&&(re.d(1),re=null),$[0]&114788&&(De=Ie(B[6]),fe=Lt(fe,$,He,1,B,De,Fe,Ee,Mt,It,null,gt),!De.length&&ue?ue.p(B,$):De.length?ue&&(ue.d(1),ue=null):(ue=Tt(),ue.c(),ue.m(Ee,null))),B[6].length>0?ve?ve.p(B,$):(ve=xt(B),ve.c(),ve.m(ne,null)):ve&&(ve.d(1),ve=null)},i:pe,o:pe,d(B){B&&f(e),qe(O,B),we.d(),ae&&ae.d(),s[24](null),re&&re.d();for(let $=0;$<fe.length;$+=1)fe[$].d();ue&&ue.d(),ve&&ve.d(),s[28](null),u=!1,Oe(V)}}}function Kt(s,e,t){let{frame:l=null}=e,{videoId:n=""}=e;const a=Qe();let i,d,r,T=[],m=0,h=.35,k=!1,b,y,S,x=null,Y=[],F="",M=1,P=!1,w,g;const p=["#FF0000","#0000FF","#FFFF00","#00FF00","#800080","#FFA500","#00FFFF","#8B4513","#CCCCCC","#FFC0CB","#32CD32","#FFD700"];Vt(async()=>{if(window.fabric)D();else{const u=document.createElement("script");u.src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js",u.onload=D,document.head.appendChild(u)}try{const u=await fetch("/api/classes");t(2,T=await u.json())}catch(u){console.error("Failed to load classes:",u)}}),Ft(()=>{r&&r.dispose()});function D(){t(19,r=new fabric.Canvas(d,{selection:!1})),r.on("mouse:down",L),r.on("mouse:move",le),r.on("mouse:up",te),r.on("selection:created",E),r.on("selection:updated",E),r.on("selection:cleared",()=>{t(5,x=null)}),r.on("object:modified",Q),r.on("object:moving",j),r.on("object:scaling",j),r.on("mouse:wheel",I),l&&A()}function I(u){const V=u.e.deltaY;let X=r.getZoom();X*=.999**V,X>5&&(X=5),X<.5&&(X=.5),r.zoomToPoint({x:u.e.offsetX,y:u.e.offsetY},X),t(8,M=X),u.e.preventDefault(),u.e.stopPropagation()}function K(){r.setViewportTransform([1,0,0,1,0,0]),t(8,M=1)}let W=null,N=null;function A(){if(!r||!l)return;const u=l.frame_id;N=u,r.clear(),t(5,x=null),t(6,Y=[]),r.setViewportTransform([1,0,0,1,0,0]),t(8,M=1),fabric.Image.fromURL(`/api/frames/${n}/${l.frame_id}/image`,V=>{if(N!==u)return;r.clear();const X=i.clientWidth-20,O=i.clientHeight-200,ce=Math.min(X/V.width,O/V.height,1);r.setWidth(V.width*ce),r.setHeight(V.height*ce),r.setBackgroundImage(V,r.renderAll.bind(r),{scaleX:ce,scaleY:ce}),l.labels&&l.labels.forEach(ge=>{ie(ge)}),Q()},{crossOrigin:"anonymous"})}function ie(u){const V=r.getWidth(),X=r.getHeight(),O=(u.x_center-u.width/2)*V,ce=(u.y_center-u.height/2)*X,ge=u.width*V,we=u.height*X,ae=p[u.class_id]||"#FF0000",re=u.confidence?` ${Math.round(u.confidence*100)}%`:"",De=new fabric.Text(`${u.class_name}${re}`,{left:O,top:ce-16,fontSize:12,fill:"#fff",backgroundColor:ae,padding:2,selectable:!1,evented:!1}),He=new fabric.Rect({left:O,top:ce,width:ge,height:we,fill:"transparent",stroke:ae,strokeWidth:2,selectable:!0,hasControls:!0,cornerColor:ae,cornerSize:8,transparentCorners:!1,labelData:{...u},labelText:De});r.add(De),r.add(He)}function Q(){if(!r)return;const u=[];r.getObjects("rect").forEach((X,O)=>{X.labelData&&u.push({index:O,...X.labelData,rect:X})}),t(6,Y=u)}function E(u){var X;const V=(X=u.selected)==null?void 0:X[0];V&&V.type==="rect"&&V.labelData&&(t(5,x=V),t(3,m=V.labelData.class_id)),Q()}function j(u){const V=u.target;V&&V.type==="rect"&&V.labelText&&(V.labelText.set({left:V.left,top:V.top-16}),r.renderAll())}function L(u){if(u.e.altKey||u.e.button===1){P=!0,w=u.e.clientX,g=u.e.clientY,t(19,r.selection=!1,r);return}if(u.target)return;k=!0;const V=r.getPointer(u.e);b=V.x,y=V.y,S=new fabric.Rect({left:b,top:y,width:0,height:0,fill:"transparent",stroke:p[m],strokeWidth:2,selectable:!1}),r.add(S)}function le(u){if(P){const ce=r.viewportTransform;ce[4]+=u.e.clientX-w,ce[5]+=u.e.clientY-g,w=u.e.clientX,g=u.e.clientY,r.requestRenderAll();return}if(!k||!S)return;const V=r.getPointer(u.e),X=V.x-b,O=V.y-y;S.set({width:Math.abs(X),height:Math.abs(O),left:X<0?V.x:b,top:O<0?V.y:y}),r.renderAll()}function te(){var O;if(P){P=!1,t(19,r.selection=!1,r);return}if(!k||!S)return;if(k=!1,S.width<10||S.height<10){r.remove(S),S=null;return}const u=((O=T[m])==null?void 0:O.class_name)||`class_${m}`,V=p[m],X=new fabric.Text(u,{left:S.left,top:S.top-16,fontSize:12,fill:"#fff",backgroundColor:V,padding:2,selectable:!1,evented:!1});S.set({selectable:!0,hasControls:!0,cornerColor:V,cornerSize:8,transparentCorners:!1,labelData:{class_id:m,class_name:u,confidence:null,source:"manual"},labelText:X}),r.add(X),r.renderAll(),S=null,Q()}function se(){const u=[],V=r.getWidth(),X=r.getHeight();return r.getObjects("rect").forEach(O=>{if(!O.labelData)return;const ce=O.scaleX||1,ge=O.scaleY||1,we=(O.left+O.width*ce/2)/V,ae=(O.top+O.height*ge/2)/X,re=O.width*ce/V,De=O.height*ge/X;u.push({class_id:O.labelData.class_id,class_name:O.labelData.class_name,x_center:we,y_center:ae,width:re,height:De,confidence:O.labelData.confidence,source:O.labelData.source||"manual"})}),u}async function _e(){try{await fetch(`/api/frames/${n}/${l.frame_id}/auto-label`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({confidence_threshold:h})});const V=await(await fetch(`/api/frames/${n}/${l.frame_id}`)).json();t(17,l.labels=V.labels,l),t(20,W=null),A(),a("update")}catch(u){console.error("Auto-label failed:",u)}}async function H(){const u=se();t(7,F="saving");try{await fetch(`/api/frames/${n}/${l.frame_id}/labels`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({labels:u})}),t(17,l.labels=u,l),a("update"),t(7,F="saved"),setTimeout(()=>{t(7,F="")},2e3)}catch(V){console.error("Save failed:",V),t(7,F="")}}function G(){x&&(x.labelText&&r.remove(x.labelText),r.remove(x),t(5,x=null),r.renderAll(),Q())}function de(){confirm("Clear all bounding boxes?")&&(r.getObjects("rect").forEach(V=>{V.labelText&&r.remove(V.labelText),r.remove(V)}),t(5,x=null),r.renderAll(),Q())}function Ce(u){u.rect&&(r.setActiveObject(u.rect),r.renderAll(),t(5,x=u.rect),t(3,m=u.class_id))}function ne(u,V){V.stopPropagation(),u.rect&&(u.rect.labelText&&r.remove(u.rect.labelText),r.remove(u.rect),x===u.rect&&t(5,x=null),r.renderAll(),Q())}function Te(u,V,X){if(X.stopPropagation(),u.rect&&u.rect.labelData){const O=T[V],ce=(O==null?void 0:O.class_name)||`class_${V}`,ge=p[V];if(u.rect.labelData.class_id=V,u.rect.labelData.class_name=ce,u.rect.set({stroke:ge,cornerColor:ge}),u.rect.labelText){const we=u.rect.labelData.confidence?` ${Math.round(u.rect.labelData.confidence*100)}%`:"";u.rect.labelText.set({text:`${ce}${we}`,backgroundColor:ge})}r.renderAll(),Q()}}function be(u){At.call(this,s,u)}function ke(){m=Nt(this),t(3,m),t(2,T)}function Se(){h=jt(this.value),t(4,h)}function xe(u){it[u?"unshift":"push"](()=>{d=u,t(1,d)})}const Ee=(u,V)=>Te(u,parseInt(V.target.value),V),fe=(u,V)=>ne(u,V),Fe=u=>Ce(u);function Be(u){it[u?"unshift":"push"](()=>{i=u,t(0,i)})}return s.$$set=u=>{"frame"in u&&t(17,l=u.frame),"videoId"in u&&t(18,n=u.videoId)},s.$$.update=()=>{s.$$.dirty[0]&1703936&&l&&r&&l.frame_id!==W&&(t(20,W=l.frame_id),A())},[i,d,T,m,h,x,Y,F,M,K,_e,H,G,de,Ce,ne,Te,l,n,r,W,be,ke,Se,xe,Ee,fe,Fe,Be]}class Qt extends Ze{constructor(e){super(),Ge(this,e,Kt,Jt,Xe,{frame:17,videoId:18},null,[-1,-1])}}function $t(s){let e,t,l,n,a,i,d,r,T,m,h,k,b,y,S,x,Y="Custom name applies to single video only",F,M;return{c(){e=v("div"),t=v("input"),l=z(),n=v("label"),a=Ye("svg"),i=Ye("path"),d=Z(`
              Select Video(s)
              `),r=v("input"),T=z(),m=v("label"),h=Ye("svg"),k=Ye("path"),b=Z(`
              Select Folder
              `),y=v("input"),S=z(),x=v("p"),x.textContent=Y,this.h()},l(P){e=_(P,"DIV",{class:!0});var w=C(e);t=_(w,"INPUT",{type:!0,placeholder:!0,class:!0}),l=U(w),n=_(w,"LABEL",{class:!0});var g=C(n);a=Re(g,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var p=C(a);i=Re(p,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),C(i).forEach(f),p.forEach(f),d=q(g,`
              Select Video(s)
              `),r=_(g,"INPUT",{type:!0,accept:!0,class:!0}),g.forEach(f),T=U(w),m=_(w,"LABEL",{class:!0});var D=C(m);h=Re(D,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var I=C(h);k=Re(I,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),C(k).forEach(f),I.forEach(f),b=q(D,`
              Select Folder
              `),y=_(D,"INPUT",{type:!0,accept:!0,webkitdirectory:!0,class:!0}),D.forEach(f),w.forEach(f),S=U(P),x=_(P,"P",{class:!0,"data-svelte-h":!0}),ee(x)!=="svelte-90dcdk"&&(x.textContent=Y),this.h()},h(){c(t,"type","text"),c(t,"placeholder","Custom folder name (optional)"),c(t,"class","input input-bordered input-sm w-full"),c(i,"stroke-linecap","round"),c(i,"stroke-linejoin","round"),c(i,"stroke-width","2"),c(i,"d","M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"),c(a,"xmlns","http://www.w3.org/2000/svg"),c(a,"class","h-4 w-4 mr-1"),c(a,"fill","none"),c(a,"viewBox","0 0 24 24"),c(a,"stroke","currentColor"),c(r,"type","file"),c(r,"accept",".avi,.mp4,.mov,.mkv,.wmv"),r.multiple=!0,c(r,"class","hidden"),c(n,"class","btn btn-sm btn-outline btn-primary w-full"),c(k,"stroke-linecap","round"),c(k,"stroke-linejoin","round"),c(k,"stroke-width","2"),c(k,"d","M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"),c(h,"xmlns","http://www.w3.org/2000/svg"),c(h,"class","h-4 w-4 mr-1"),c(h,"fill","none"),c(h,"viewBox","0 0 24 24"),c(h,"stroke","currentColor"),c(y,"type","file"),c(y,"accept",".avi,.mp4,.mov,.mkv,.wmv"),c(y,"webkitdirectory",""),c(y,"class","hidden"),c(m,"class","btn btn-sm btn-outline btn-secondary w-full"),c(e,"class","flex flex-col gap-2"),c(x,"class","text-xs opacity-50 mt-1")},m(P,w){J(P,e,w),o(e,t),ye(t,s[6]),o(e,l),o(e,n),o(n,a),o(a,i),o(n,d),o(n,r),o(e,T),o(e,m),o(m,h),o(h,k),o(m,b),o(m,y),J(P,S,w),J(P,x,w),F||(M=[oe(t,"input",s[13]),oe(r,"change",s[10]),oe(y,"change",s[10])],F=!0)},p(P,w){w&64&&t.value!==P[6]&&ye(t,P[6])},d(P){P&&(f(e),f(S),f(x)),F=!1,Oe(M)}}}function el(s){let e,t,l,n,a,i,d=s[5].current+"",r,T,m=s[5].total+"",h,k;return{c(){e=v("div"),t=v("progress"),a=z(),i=v("span"),r=Z(d),T=Z(" / "),h=Z(m),k=Z(" videos"),this.h()},l(b){e=_(b,"DIV",{class:!0});var y=C(e);t=_(y,"PROGRESS",{class:!0,max:!0}),C(t).forEach(f),a=U(y),i=_(y,"SPAN",{class:!0});var S=C(i);r=q(S,d),T=q(S," / "),h=q(S,m),k=q(S," videos"),S.forEach(f),y.forEach(f),this.h()},h(){c(t,"class","progress progress-primary w-full"),t.value=l=s[5].current,c(t,"max",n=s[5].total),c(i,"class","text-xs text-center"),c(e,"class","flex flex-col gap-2")},m(b,y){J(b,e,y),o(e,t),o(e,a),o(e,i),o(i,r),o(i,T),o(i,h),o(i,k)},p(b,y){y&32&&l!==(l=b[5].current)&&(t.value=l),y&32&&n!==(n=b[5].total)&&c(t,"max",n),y&32&&d!==(d=b[5].current+"")&&he(r,d),y&32&&m!==(m=b[5].total+"")&&he(h,m)},d(b){b&&f(e)}}}function tl(s){let e,t='<div class="card-body items-center justify-center"><p class="text-base-content/50">Select a video to view frames</p></div>';return{c(){e=v("div"),e.innerHTML=t,this.h()},l(l){e=_(l,"DIV",{class:!0,"data-svelte-h":!0}),ee(e)!=="svelte-1cgu05p"&&(e.innerHTML=t),this.h()},h(){c(e,"class","card bg-base-200 shadow-xl flex-1")},m(l,n){J(l,e,n)},p:pe,i:pe,o:pe,d(l){l&&f(e)}}}function ll(s){let e,t,l,n,a,i="1 sec",d,r="5 sec",T,m="10 sec",h,k="15 sec",b,y="30 sec",S,x,Y="Extract Frames",F,M,P,w,g,p=s[2].length+"",D,I,K,W,N,A,ie,Q;return N=new Wt({props:{frames:s[2],selectedFrame:s[3],videoId:s[1].video_id}}),N.$on("select",s[15]),{c(){e=v("div"),t=v("div"),l=v("div"),n=v("select"),a=v("option"),a.textContent=i,d=v("option"),d.textContent=r,T=v("option"),T.textContent=m,h=v("option"),h.textContent=k,b=v("option"),b.textContent=y,S=z(),x=v("button"),x.textContent=Y,F=z(),M=v("div"),P=v("div"),w=v("h2"),g=Z("Frames ("),D=Z(p),I=Z(")"),K=z(),W=v("div"),lt(N.$$.fragment),this.h()},l(E){e=_(E,"DIV",{class:!0});var j=C(e);t=_(j,"DIV",{class:!0});var L=C(t);l=_(L,"DIV",{class:!0});var le=C(l);n=_(le,"SELECT",{id:!0,class:!0});var te=C(n);a=_(te,"OPTION",{"data-svelte-h":!0}),ee(a)!=="svelte-1l2urm3"&&(a.textContent=i),d=_(te,"OPTION",{"data-svelte-h":!0}),ee(d)!=="svelte-194rc23"&&(d.textContent=r),T=_(te,"OPTION",{"data-svelte-h":!0}),ee(T)!=="svelte-1t2yoiw"&&(T.textContent=m),h=_(te,"OPTION",{"data-svelte-h":!0}),ee(h)!=="svelte-13i6z85"&&(h.textContent=k),b=_(te,"OPTION",{"data-svelte-h":!0}),ee(b)!=="svelte-1lapxut"&&(b.textContent=y),te.forEach(f),S=U(le),x=_(le,"BUTTON",{class:!0,"data-svelte-h":!0}),ee(x)!=="svelte-1y3x4tz"&&(x.textContent=Y),le.forEach(f),L.forEach(f),j.forEach(f),F=U(E),M=_(E,"DIV",{class:!0});var se=C(M);P=_(se,"DIV",{class:!0});var _e=C(P);w=_(_e,"H2",{class:!0});var H=C(w);g=q(H,"Frames ("),D=q(H,p),I=q(H,")"),H.forEach(f),K=U(_e),W=_(_e,"DIV",{class:!0});var G=C(W);tt(N.$$.fragment,G),G.forEach(f),_e.forEach(f),se.forEach(f),this.h()},h(){a.__value="1",ye(a,a.__value),d.__value="5",ye(d,d.__value),T.__value="10",ye(T,T.__value),T.selected=!0,h.__value="15",ye(h,h.__value),b.__value="30",ye(b,b.__value),c(n,"id","extract-interval"),c(n,"class","select select-bordered select-sm flex-1"),c(x,"class","btn btn-primary btn-sm"),c(l,"class","flex gap-2 items-center"),c(t,"class","card-body p-4"),c(e,"class","card bg-base-200 shadow-xl shrink-0"),c(w,"class","card-title text-sm shrink-0"),c(W,"class","overflow-y-auto flex-1 min-h-0"),c(P,"class","card-body p-4 h-full flex flex-col"),c(M,"class","card bg-base-200 shadow-xl flex-1 min-h-0")},m(E,j){J(E,e,j),o(e,t),o(t,l),o(l,n),o(n,a),o(n,d),o(n,T),o(n,h),o(n,b),o(l,S),o(l,x),J(E,F,j),J(E,M,j),o(M,P),o(P,w),o(w,g),o(w,D),o(w,I),o(P,K),o(P,W),et(N,W,null),A=!0,ie||(Q=oe(x,"click",s[11]),ie=!0)},p(E,j){(!A||j&4)&&p!==(p=E[2].length+"")&&he(D,p);const L={};j&4&&(L.frames=E[2]),j&8&&(L.selectedFrame=E[3]),j&2&&(L.videoId=E[1].video_id),N.$set(L)},i(E){A||(Ve(N.$$.fragment,E),A=!0)},o(E){je(N.$$.fragment,E),A=!1},d(E){E&&(f(e),f(F),f(M)),$e(N),ie=!1,Q()}}}function sl(s){let e,t='<p class="text-base-content/50">Select a frame to start labeling</p>';return{c(){e=v("div"),e.innerHTML=t,this.h()},l(l){e=_(l,"DIV",{class:!0,"data-svelte-h":!0}),ee(e)!=="svelte-1ysb5l2"&&(e.innerHTML=t),this.h()},h(){c(e,"class","flex items-center justify-center h-full")},m(l,n){J(l,e,n)},p:pe,i:pe,o:pe,d(l){l&&f(e)}}}function nl(s){let e,t;return e=new Qt({props:{frame:s[3],videoId:s[1].video_id}}),e.$on("update",s[12]),{c(){lt(e.$$.fragment)},l(l){tt(e.$$.fragment,l)},m(l,n){et(e,l,n),t=!0},p(l,n){const a={};n&8&&(a.frame=l[3]),n&2&&(a.videoId=l[1].video_id),e.$set(a)},i(l){t||(Ve(e.$$.fragment,l),t=!0)},o(l){je(e.$$.fragment,l),t=!1},d(l){$e(e,l)}}}function al(s){let e,t,l,n,a,i="Upload Videos",d,r,T,m,h,k,b=s[0].length+"",y,S,x,Y,F,M,P,w,g,p,D,I,K,W,N,A;function ie(H,G){return H[4]?el:$t}let Q=ie(s),E=Q(s);F=new Ht({props:{videos:s[0],selectedVideo:s[1]}}),F.$on("select",s[14]),F.$on("refresh",s[7]);const j=[ll,tl],L=[];function le(H,G){return H[1]?0:1}w=le(s),g=L[w]=j[w](s);const te=[nl,sl],se=[];function _e(H,G){return H[3]?0:1}return W=_e(s),N=se[W]=te[W](s),{c(){e=v("div"),t=v("div"),l=v("div"),n=v("div"),a=v("h2"),a.textContent=i,d=z(),E.c(),r=z(),T=v("div"),m=v("div"),h=v("h2"),k=Z("Videos ("),y=Z(b),S=Z(")"),x=z(),Y=v("div"),lt(F.$$.fragment),M=z(),P=v("div"),g.c(),p=z(),D=v("div"),I=v("div"),K=v("div"),N.c(),this.h()},l(H){e=_(H,"DIV",{class:!0});var G=C(e);t=_(G,"DIV",{class:!0});var de=C(t);l=_(de,"DIV",{class:!0});var Ce=C(l);n=_(Ce,"DIV",{class:!0});var ne=C(n);a=_(ne,"H2",{class:!0,"data-svelte-h":!0}),ee(a)!=="svelte-1kfecm3"&&(a.textContent=i),d=U(ne),E.l(ne),ne.forEach(f),Ce.forEach(f),r=U(de),T=_(de,"DIV",{class:!0});var Te=C(T);m=_(Te,"DIV",{class:!0});var be=C(m);h=_(be,"H2",{class:!0});var ke=C(h);k=q(ke,"Videos ("),y=q(ke,b),S=q(ke,")"),ke.forEach(f),x=U(be),Y=_(be,"DIV",{class:!0});var Se=C(Y);tt(F.$$.fragment,Se),Se.forEach(f),be.forEach(f),Te.forEach(f),de.forEach(f),M=U(G),P=_(G,"DIV",{class:!0});var xe=C(P);g.l(xe),xe.forEach(f),p=U(G),D=_(G,"DIV",{class:!0});var Ee=C(D);I=_(Ee,"DIV",{class:!0});var fe=C(I);K=_(fe,"DIV",{class:!0});var Fe=C(K);N.l(Fe),Fe.forEach(f),fe.forEach(f),Ee.forEach(f),G.forEach(f),this.h()},h(){c(a,"class","card-title text-sm"),c(n,"class","card-body p-4"),c(l,"class","card bg-base-200 shadow-xl"),c(h,"class","card-title text-sm"),c(Y,"class","overflow-y-auto flex-1"),c(m,"class","card-body p-4"),c(T,"class","card bg-base-200 shadow-xl flex-1 overflow-hidden"),c(t,"class","col-span-3 flex flex-col gap-4 overflow-hidden"),c(P,"class","col-span-3 flex flex-col gap-4 overflow-hidden"),c(K,"class","card-body p-4 h-full overflow-hidden"),c(I,"class","card bg-base-200 shadow-xl h-full"),c(D,"class","col-span-6 overflow-hidden"),c(e,"class","grid grid-cols-12 gap-4 h-[calc(100vh-140px)]")},m(H,G){J(H,e,G),o(e,t),o(t,l),o(l,n),o(n,a),o(n,d),E.m(n,null),o(t,r),o(t,T),o(T,m),o(m,h),o(h,k),o(h,y),o(h,S),o(m,x),o(m,Y),et(F,Y,null),o(e,M),o(e,P),L[w].m(P,null),o(e,p),o(e,D),o(D,I),o(I,K),se[W].m(K,null),A=!0},p(H,[G]){Q===(Q=ie(H))&&E?E.p(H,G):(E.d(1),E=Q(H),E&&(E.c(),E.m(n,null))),(!A||G&1)&&b!==(b=H[0].length+"")&&he(y,b);const de={};G&1&&(de.videos=H[0]),G&2&&(de.selectedVideo=H[1]),F.$set(de);let Ce=w;w=le(H),w===Ce?L[w].p(H,G):(dt(),je(L[Ce],1,1,()=>{L[Ce]=null}),ct(),g=L[w],g?g.p(H,G):(g=L[w]=j[w](H),g.c()),Ve(g,1),g.m(P,null));let ne=W;W=_e(H),W===ne?se[W].p(H,G):(dt(),je(se[ne],1,1,()=>{se[ne]=null}),ct(),N=se[W],N?N.p(H,G):(N=se[W]=te[W](H),N.c()),Ve(N,1),N.m(K,null))},i(H){A||(Ve(F.$$.fragment,H),Ve(g),Ve(N),A=!0)},o(H){je(F.$$.fragment,H),je(g),je(N),A=!1},d(H){H&&f(e),E.d(),$e(F),L[w].d(),se[W].d()}}}const Ne="/api";function ol(s,e,t){let l=[],n=null,a=[],i=null,d={total_videos:0,total_frames:0,approved_frames:0};Vt(async()=>{await r(),await T()});async function r(){try{const w=await fetch(`${Ne}/videos`);t(0,l=await w.json())}catch(w){console.error("Failed to load videos:",w)}}async function T(){try{d=await(await fetch(`${Ne}/stats`)).json(),document.getElementById("stat-videos").textContent=d.total_videos,document.getElementById("stat-frames").textContent=d.total_frames,document.getElementById("stat-labeled").textContent=d.approved_frames}catch(w){console.error("Failed to load stats:",w)}}async function m(w){t(1,n=w),t(3,i=null);try{const p=await(await fetch(`${Ne}/videos/${w.video_id}/frames`)).json();t(2,a=p.frames||[])}catch(g){console.error("Failed to load frames:",g),t(2,a=[])}}async function h(w){try{const g=await fetch(`${Ne}/frames/${n.video_id}/${w.frame_id}`);t(3,i=await g.json())}catch(g){console.error("Failed to load frame:",g)}}let k=!1,b={current:0,total:0},y="";async function S(w){var p;const g=Array.from(w.target.files).filter(D=>D.name.match(/\.(avi|mp4|mov|mkv|wmv)$/i));if(g.length){t(4,k=!0),t(5,b={current:0,total:g.length});for(let D=0;D<g.length;D++){const I=g[D],K=new FormData;K.append("file",I),y.trim()&&g.length===1&&K.append("custom_name",y.trim());const W=(p=I.webkitRelativePath)==null?void 0:p.split("/");W&&W.length>1&&K.append("folder_name",W[0]);try{await fetch(`${Ne}/videos/upload`,{method:"POST",body:K}),t(5,b.current++,b),t(5,b)}catch(N){console.error("Upload failed:",N)}}t(4,k=!1),t(6,y=""),await r(),await T(),w.target.value=""}}async function x(){if(!n)return;const w=document.getElementById("extract-interval").value;try{const p=await(await fetch(`${Ne}/videos/${n.video_id}/extract`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({frame_interval:parseInt(w)})})).json();alert(`Extracted ${p.frames_extracted} frames`),await m(n),await T()}catch(g){console.error("Extract failed:",g)}}async function Y(){if(n){const g=await(await fetch(`${Ne}/videos/${n.video_id}/frames`)).json();t(2,a=g.frames||[])}T()}function F(){y=this.value,t(6,y)}return[l,n,a,i,k,b,y,r,m,h,S,x,Y,F,w=>m(w.detail),w=>h(w.detail)]}class cl extends Ze{constructor(e){super(),Ge(this,e,ol,al,Xe,{})}}export{cl as component};
